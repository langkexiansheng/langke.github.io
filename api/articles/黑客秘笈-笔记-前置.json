{"title":"黑客秘笈-笔记-前置","slug":"黑客秘笈-笔记-前置","date":"2019-03-26T02:47:37.000Z","updated":"2019-03-27T05:57:19.161Z","comments":true,"path":"api/articles/黑客秘笈-笔记-前置.json","photos":[],"link":"","excerpt":"作者的渗透测试标准情报搜集最初的立足点本地/网络枚举本地权限提升持续控制横向渗透域权限提升导出哈希值信息识别/提取10.撰写报告","covers":null,"content":"<h1 id=\"作者的渗透测试标准\"><a href=\"#作者的渗透测试标准\" class=\"headerlink\" title=\"作者的渗透测试标准\"></a>作者的渗透测试标准</h1><ul>\n<li><ol>\n<li>情报搜集</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>最初的立足点</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>本地/网络枚举</li>\n</ol>\n</li>\n<li><ol start=\"4\">\n<li>本地权限提升</li>\n</ol>\n</li>\n<li><ol start=\"5\">\n<li>持续控制</li>\n</ol>\n</li>\n<li><ol start=\"6\">\n<li>横向渗透</li>\n</ol>\n</li>\n<li><ol start=\"7\">\n<li>域权限提升</li>\n</ol>\n</li>\n<li><ol start=\"8\">\n<li>导出哈希值</li>\n</ol>\n</li>\n<li><ol start=\"9\">\n<li>信息识别/提取</li>\n</ol>\n</li>\n<li>10.撰写报告</li>\n</ul>\n<a id=\"more\"></a>\n<h2 id=\"第一章-安装\"><a href=\"#第一章-安装\" class=\"headerlink\" title=\"第一章 安装\"></a>第一章 安装</h2><h4 id=\"1-1-建立测试环境\"><a href=\"#1-1-建立测试环境\" class=\"headerlink\" title=\"1.1 建立测试环境\"></a>1.1 建立测试环境</h4><p>Linux服务器或者Windows系统</p>\n<h4 id=\"1-2-建立一个域\"><a href=\"#1-2-建立一个域\" class=\"headerlink\" title=\"1.2 建立一个域\"></a>1.2 建立一个域</h4><p>Windows 2012 R12<br>Windows 10<br>Windows 7</p>\n<p>参考链接：<a href=\"http://www.thehackerplaybook.com/Windows_Domain.htm\" target=\"_blank\" rel=\"noopener\">http://www.thehackerplaybook.com/Windows_Domain.htm</a></p>\n<h4 id=\"1-3-建立其他的服务器\"><a href=\"#1-3-建立其他的服务器\" class=\"headerlink\" title=\"1.3 建立其他的服务器\"></a>1.3 建立其他的服务器</h4><ul>\n<li>Metasploitable 2</li>\n</ul>\n<p>一个非常好的Ubuntu Linux虚拟机，它预置了常用的漏洞。基于这个框架，可以很方便地使用安全工具（例如Metasploit）开展测试，以及演示常用攻击方法。<br>详情地址：<a href=\"https://sourceforge.net/projects/metasploitable/files/\" target=\"_blank\" rel=\"noopener\">https://sourceforge.net/projects/metasploitable/files/</a></p>\n<ul>\n<li>OWASPBWA(OWASP Broken Web Applications Project)</li>\n</ul>\n<p>大量存在漏洞的网站应用程序。对于单虚拟机来说，这是搜集的最完整的漏洞网站应用中的一个。这个虚拟机将在全书中多个网站应用例子中使用。<br>详情地址：<a href=\"https://sourceforge.net/projects/owaspbwa/files/\" target=\"_blank\" rel=\"noopener\">https://sourceforge.net/projects/owaspbwa/files/</a></p>\n<h4 id=\"1-4-实践\"><a href=\"#1-4-实践\" class=\"headerlink\" title=\"1.4 实践\"></a>1.4 实践</h4><p>每一次渗透测试都是完全不一样的。如果没有各种实际的操作经验、熟悉多种不同的工具以及使用不同的净荷渗透系统，即使遇到很小的问题，也很难克服。</p>\n<h4 id=\"1-5-构建渗透测试环境\"><a href=\"#1-5-构建渗透测试环境\" class=\"headerlink\" title=\"1.5 构建渗透测试环境\"></a>1.5 构建渗透测试环境</h4><p>以Kali Linux为例，它包括了大量工具，如果不知道都有哪些工具，紧急情况下就很难使用这个工具。</p>\n<h5 id=\"1-5-1-安装一个渗透测试环境\"><a href=\"#1-5-1-安装一个渗透测试环境\" class=\"headerlink\" title=\"1.5.1 安装一个渗透测试环境\"></a>1.5.1 安装一个渗透测试环境</h5><p>如果经济充足，最好携带两个笔记本，一个Windows，一个OS X<br>另外还要安装虚拟机： VirtualBox、VMWarePlayer<br>因为要在虚拟机上安装大量的工具，所以最重要的一点是保证初始系统是干净的。<br>在基础镜像中不要浏览个人网站，不至于把恶意软件带到客户网站，或者运行带有未知漏洞的服务。</p>\n<h5 id=\"1-5-2-硬件\"><a href=\"#1-5-2-硬件\" class=\"headerlink\" title=\"1.5.2 硬件\"></a>1.5.2 硬件</h5><p>1.渗透测试笔记本</p>\n<ul>\n<li>至少有8GB内存的笔记本电脑</li>\n<li>500GB的硬盘空间（最好是固态硬盘）</li>\n<li>Intel 酷睿i7四核处理器</li>\n</ul>\n<ol start=\"2\">\n<li>密码暴力破解/多用途黑客设备</li>\n</ol>\n<p>机箱：海盗船复仇C70<br>显卡：SAPPHIRE 100360SR Radeon R9 295x2 8GB GDDR5<br>硬盘：三星 840 EVO MZ-7TE500BW 2.5” 500GB SATA III TLC Internal 固态盘<br>电源：银欣 ST1500 1500W ATX<br>内存：海盗船复仇 16GB(2x8GB)240针脚DDR3 SDRAM DDR3 1600<br>CPU： 酷睿i7 4790K 4.0G<br>主板：华硕MAXIMUS VII FORMULA<br>处理器风扇：酷冷至尊Hyper 212 EV</p>\n<h5 id=\"1-5-3-开源软件和商业软件\"><a href=\"#1-5-3-开源软件和商业软件\" class=\"headerlink\" title=\"1.5.3 开源软件和商业软件\"></a>1.5.3 开源软件和商业软件</h5><p>有开源用开源，没开源找破解，没破解找关系。</p>\n<ol>\n<li>书中用到的商业软件</li>\n</ol>\n<ul>\n<li>Burp Suite Pro</li>\n<li>Canvas</li>\n<li>Cobalt Strike</li>\n<li>Core Impact</li>\n<li>Nessus</li>\n<li>Nexpose</li>\n</ul>\n<ol start=\"2\">\n<li>Kali Linux</li>\n</ol>\n<p>基于Debian操作系统发行版，包括大量不同类型的安全工具。一般装在虚拟机里。</p>\n<ol start=\"3\">\n<li>Back Box</li>\n</ol>\n<p>基于Ubuntu操作系统，虽然渗透平台有kali就够了，但是最好不要依赖某一工具、操作系统和程序。因为开发者可能停止支持某种工具，或者更坏的情况，您开始变得视野狭窄以及过度依赖老的方法。并且Back Box提供默认的用户权限管理。</p>\n<h5 id=\"1-5-4-建立平台\"><a href=\"#1-5-4-建立平台\" class=\"headerlink\" title=\"1.5.4 建立平台\"></a>1.5.4 建立平台</h5><p>任何一个发行版，都存在一些工具没有包含其中、一些工具需要进行调整的情况。</p>\n<p>探测扫描工具：</p>\n<ul>\n<li>Discover</li>\n<li>EyeWitness</li>\n<li>HTTPScreenShot</li>\n<li>WMAP</li>\n<li>SpiderFoot</li>\n<li>Masscan</li>\n<li>Gitrob</li>\n<li>CMSmap</li>\n<li>Recon-ng</li>\n<li>SPARTA</li>\n<li>WPScan</li>\n<li>Password Lists</li>\n</ul>\n<p>漏洞利用工具：</p>\n<ul>\n<li>Brup Suite Pro</li>\n<li>ZAP Proxy Pro</li>\n<li>NoSQLMap</li>\n<li>SQLMap</li>\n<li>SQLNinja</li>\n<li>BeFF Exploitation Framework</li>\n<li>Responder</li>\n<li>Printer Exploits</li>\n<li>Veil</li>\n<li>WIFIPhisher</li>\n<li>Wifite</li>\n<li>SET</li>\n</ul>\n<p>后渗透测试：</p>\n<ul>\n<li>本书中的自定义脚本</li>\n<li>SMBexec</li>\n<li>Veil</li>\n<li>WCE</li>\n<li>Mimikatz</li>\n<li>PowerSploit</li>\n<li>Nishang</li>\n<li>后门制造工厂</li>\n<li>DSHashes</li>\n<li>Net-Creds</li>\n</ul>\n<h5 id=\"1-5-5-搭建Kali-Linux\"><a href=\"#1-5-5-搭建Kali-Linux\" class=\"headerlink\" title=\"1.5.5 搭建Kali Linux\"></a>1.5.5 搭建Kali Linux</h5><ol>\n<li>Kali 虚拟机启动和运行</li>\n</ol>\n<ul>\n<li>使用用户名root和默认密码toor登陆</li>\n<li>修改密码： passwd</li>\n<li>更新镜像：apt-get update、 apt-get dist-upgrade</li>\n<li>设置 Metasploit数据库：service postgresql start</li>\n<li>让postgresql数据库在启动时加载：update-rc.dpostgresql enable</li>\n<li>启动和停止 Metasploit 服务（设置数据库.yml文件）：service metasploit start、service metasploit stop</li>\n<li>安装gedit软件：apt-get install gedit</li>\n<li>修改主机名（很多网络管理员在DHCP的日志中查询到多台名命为Kali的主机，最好遵循渗透测试公司的主机命名规则）： gedit /etc/hostname更改主机名（替换kali）并保存、gedit /etc/hosts更改主机名（替换kali）并保存、reboot</li>\n</ul>\n<ol start=\"2\">\n<li>工具安装</li>\n</ol>\n<p>后门制造工厂</p>\n<ul>\n<li>对PE、ELF、Mach-O等二进制文件注入shellcode</li>\n<li>git clone <a href=\"https://github.com/secretsquirrel/the-backdoor-factory/opt/the-backdoorfactory\" target=\"_blank\" rel=\"noopener\">https://github.com/secretsquirrel/the-backdoor-factory/opt/the-backdoorfactory</a></li>\n<li>cd the-backdoor-factory</li>\n<li>./install.sh</li>\n</ul>\n<p>HTTPScreenShot</p>\n<ul>\n<li>HTTPScreenShot工具实现屏幕截图和大量网站网页的抓取</li>\n<li>pip install selenium</li>\n<li>git clone <a href=\"https://github.com/breenmachine/httpscreenshot.git/opt/httpscreenshot\" target=\"_blank\" rel=\"noopener\">https://github.com/breenmachine/httpscreenshot.git/opt/httpscreenshot</a></li>\n<li>cd /opt/httpscreenshot</li>\n<li>chmod +x install-dependencies.sh &amp;&amp; ./install-dependencies.sh</li>\n<li>HTTPScreenShot 仅仅默认工作在64位Kali操作系统</li>\n</ul>\n<p>SMBExec</p>\n<ul>\n<li>使用samba工具的一种快速psexec类型攻击</li>\n<li>git clone <a href=\"https://github.com/pentestgeek/smbexec.git/opt/smbexec\" target=\"_blank\" rel=\"noopener\">https://github.com/pentestgeek/smbexec.git/opt/smbexec</a></li>\n<li>cd /opt/smbexec &amp;&amp; ./install.sh</li>\n<li>选择1-Debian/Ubuntu and derivatives</li>\n<li>选择所有默认值Select all defaults</li>\n<li>./install.sh</li>\n<li>选择4编译smbexec二进制文件</li>\n<li>编译完成后选择5退出</li>\n</ul>\n<p>Masscan</p>\n<ul>\n<li>这是最快速的互联网端口扫描工具，能够在6分钟扫描整个互联网</li>\n<li>apt-get install gitgcc make libpcap-dev</li>\n<li>git clone <a href=\"https://github.com/robertdavidgraham/masscan.git/opt/masscan\" target=\"_blank\" rel=\"noopener\">https://github.com/robertdavidgraham/masscan.git/opt/masscan</a></li>\n<li>cd /opt/masscan</li>\n<li>make</li>\n<li>make install</li>\n</ul>\n<p>Gitrob</p>\n<ul>\n<li>一种针对GitHub组织的探测工具</li>\n<li>git clone <a href=\"https://github.com/michenriksen/gitrob.git/opt/gitrob\" target=\"_blank\" rel=\"noopener\">https://github.com/michenriksen/gitrob.git/opt/gitrob</a></li>\n<li>gem install bundler</li>\n<li>service postgesql start</li>\n<li>supostgres</li>\n<li>createuser -s gitrob –pwprompt </li>\n<li>createdb -O gitrobgitrob</li>\n<li>exit</li>\n<li>cd /opt/gitrob/bin</li>\n<li>gem install gitrob</li>\n</ul>\n<p>CMSmap</p>\n<ul>\n<li>CMSmap 是基于Python开发的开源内容管理系统扫描工具，实现对安全漏洞自动扫描</li>\n<li>git clone <a href=\"https://github.com/Dionach/CMSmap\" target=\"_blank\" rel=\"noopener\">https://github.com/Dionach/CMSmap</a> /opt/CMSmap</li>\n</ul>\n<p>WPScan</p>\n<ul>\n<li>WordPress 漏洞扫描工具和暴力破解工具</li>\n<li>git clone <a href=\"https://github.com/wpscanteam/wpscan.git\" target=\"_blank\" rel=\"noopener\">https://github.com/wpscanteam/wpscan.git</a> /opt/wpscan</li>\n<li>cd /opt/wpscan &amp;&amp; ./wpscan.rb –update</li>\n</ul>\n<p>EyeWitness</p>\n<ul>\n<li>EyeWitness 工具实现网站截图，搜集服务器报头信息和判断网站是否采用默认口令</li>\n<li>git clone <a href=\"https://github.com/ChrisTruncer/EyeWitness.git\" target=\"_blank\" rel=\"noopener\">https://github.com/ChrisTruncer/EyeWitness.git</a> /opt/EyeWitness</li>\n</ul>\n<p>Printer Exploits</p>\n<ul>\n<li>包括大量常用的打印机漏洞给利用工具</li>\n<li>git clone <a href=\"https://github.com/MooseDojo/praedasploit/opt/praedasploit\" target=\"_blank\" rel=\"noopener\">https://github.com/MooseDojo/praedasploit/opt/praedasploit</a></li>\n</ul>\n<p>SQLMap</p>\n<ul>\n<li>SQL注入工具</li>\n<li>git clone <a href=\"https://github.com/sqlmapproject/sqlmap\" target=\"_blank\" rel=\"noopener\">https://github.com/sqlmapproject/sqlmap</a> /opt/sqlmap</li>\n</ul>\n<p>Recon-ng</p>\n<ul>\n<li>一个功能齐全的网站探测框架，使用Python编写</li>\n<li>git clone <a href=\"https://bitbucket.org/LaNMaSteR53/recon-ng.git\" target=\"_blank\" rel=\"noopener\">https://bitbucket.org/LaNMaSteR53/recon-ng.git</a> /opt/recon-ng</li>\n</ul>\n<p>Discover Scripts</p>\n<ul>\n<li>定制的bash脚本，自动化处理各种渗透任务</li>\n<li>git clone <a href=\"https://github.com/leebaird/discover.git\" target=\"_blank\" rel=\"noopener\">https://github.com/leebaird/discover.git</a> /opt/discover</li>\n<li>cd /opt/discover &amp;&amp; ./setup.sh</li>\n</ul>\n<p>BeEF Exploitation Framework</p>\n<ul>\n<li>一个跨站脚本攻击框架</li>\n<li>wget <a href=\"https://raw.github.com/beefproject/beef/a6a7536e/install-beef\" target=\"_blank\" rel=\"noopener\">https://raw.github.com/beefproject/beef/a6a7536e/install-beef</a></li>\n</ul>\n<p>DSHashes</p>\n<ul>\n<li>从NTDSXtract中提取用户易于理解的哈希值</li>\n<li>wget <a href=\"http://ptscripts.googlecode.com/svn/trunk/dshashes.py\" target=\"_blank\" rel=\"noopener\">http://ptscripts.googlecode.com/svn/trunk/dshashes.py</a> -O /opt/NTDSXtract/dshashes.py</li>\n</ul>\n<p>SPARTA</p>\n<ul>\n<li>一个基于Python脚本图形化应用程序，在扫描和枚举阶段，辅助渗透测试人员简化网络架构的渗透测试工作</li>\n<li>git clone <a href=\"https://github.com/secforce/sparta.git\" target=\"_blank\" rel=\"noopener\">https://github.com/secforce/sparta.git</a> /opt/sparta</li>\n<li>apt-get install python-elixir</li>\n<li>apt-get install ldap-utilsrwhorsh-client x11 -apps finger</li>\n</ul>\n<p>Nishang(PowerShell)</p>\n<ul>\n<li>PowerShell漏洞利用和后渗透测试脚本汇总</li>\n<li>git clone <a href=\"https://github.com/samratashok/nishang\" target=\"_blank\" rel=\"noopener\">https://github.com/samratashok/nishang</a> /opt/nishang</li>\n</ul>\n<p>Veil-Framework</p>\n<ul>\n<li>Veil-Evasion用于生成规避杀毒软件净荷</li>\n<li>Veil-Catapult投送净荷到目标</li>\n<li>Veil-PowerView获取Windows域网络拓扑信息</li>\n<li>Veil框架也可用于创建基于Python脚本的Meterpreter可执行程序</li>\n<li>git clone <a href=\"https://github.com/Veil-Framework/Veil\" target=\"_blank\" rel=\"noopener\">https://github.com/Veil-Framework/Veil</a> /opt/Veil</li>\n<li>cd /opt/Veil/ &amp;&amp; ./Install.sh -c</li>\n</ul>\n<p>Wifite</p>\n<ul>\n<li>WiFi网络攻击工具</li>\n<li>git clone <a href=\"https://github.com/derv82/wifite\" target=\"_blank\" rel=\"noopener\">https://github.com/derv82/wifite</a> /opt/wifite</li>\n</ul>\n<p>WIFIPhisher</p>\n<ul>\n<li>WiFi 网络自动化钓鱼攻击</li>\n<li>git clone <a href=\"https://github.com/sophron/wifihisher.git\" target=\"_blank\" rel=\"noopener\">https://github.com/sophron/wifihisher.git</a> /opt/wifiphisher</li>\n</ul>\n<h5 id=\"1-5-6-Windows-虚拟机\"><a href=\"#1-5-6-Windows-虚拟机\" class=\"headerlink\" title=\"1.5.6 Windows 虚拟机\"></a>1.5.6 Windows 虚拟机</h5><p>除Windows以外的高级工具列表</p>\n<ul>\n<li>HxD（十六进制编辑器）</li>\n<li>Evade（用于规避杀毒软件）</li>\n<li>Hyperion（用于规避杀毒软件）</li>\n<li>Metasploit</li>\n<li>Nmap</li>\n<li>oclHashcat</li>\n<li>Cain and Abel</li>\n<li>Burp Suite Pro</li>\n<li>Nishang</li>\n<li>PowerSploit</li>\n</ul>\n<h5 id=\"1-5-7-设置Windows环境\"><a href=\"#1-5-7-设置Windows环境\" class=\"headerlink\" title=\"1.5.7 设置Windows环境\"></a>1.5.7 设置Windows环境</h5><p>一定要修改主机名，如果不使用NetBios，就禁用NetBios功能，尽可能加固这些操作系统平台。</p>\n<h5 id=\"1-5-8-启动PowerShell\"><a href=\"#1-5-8-启动PowerShell\" class=\"headerlink\" title=\"1.5.8 启动PowerShell\"></a>1.5.8 启动PowerShell</h5><p>PowerShell已经彻底改变渗透测试的游戏规则，有时间一定要了解一下。</p>\n<ul>\n<li>PowerShell脚本安全介绍：<br>有哪些益处：</li>\n<li>windows 7 以上操作系统默认安装</li>\n<li>PowerShell 脚本可以运行在内存中</li>\n<li>几乎不会触发杀毒软件</li>\n<li>可以调用.NET类</li>\n<li>利用用户口令（查询活动目录）</li>\n<li>可以用来管理活动目录</li>\n<li>远程执行PowerShell脚本</li>\n<li>使得Windows脚本攻击更加容易</li>\n<li>目前很多工具是基于PowerShell开发，掌握这些工具帮助您成为能力出众、效率较高的渗透测试人员</li>\n</ul>\n<p>基本参数和基本设置</p>\n<ul>\n<li><code>-Exec Bypass</code>绕过执行安全保护</li>\n<li><code>-Nonl</code>非交互模式，PowerShell不提供用户交互提示符</li>\n<li><code>-NoProfile（或者 -Nop）</code>PowerShell控制台不加载当前用户的配置</li>\n<li><code>-noexit</code>执行后不退出shell，这对于脚本，例如键盘记录，非常重要</li>\n<li><code>-W Hidden</code>设置会话的窗口风格，将命令窗口保持隐藏</li>\n</ul>\n<h4 id=\"1-6\"><a href=\"#1-6\" class=\"headerlink\" title=\"1.6\"></a>1.6</h4><h5 id=\"1-6-2-二进制利用\"><a href=\"#1-6-2-二进制利用\" class=\"headerlink\" title=\"1.6.2 二进制利用\"></a>1.6.2 二进制利用</h5><p>二进制利用技术：<br>The Shellcoders Handbook<br>Hacking：The Art of Exploitation<br>一个非常好的学习网站：<br><a href=\"http://overthewire.org/wargames/narnia/\" target=\"_blank\" rel=\"noopener\">Over the Wire</a></p>\n<p>基础知识：</p>\n<ul>\n<li>基本的汇编语言和理解寄存器的使用</li>\n<li>GDB基础知识（GUN调试）</li>\n<li>理解不同类型的内存段（栈、堆、数据、BSS和代码段）</li>\n<li>Shellcode基本概念</li>\n</ul>\n<p>一些资源：</p>\n","categories":[],"tags":[{"name":"黑客秘笈：渗透测试实用指南","slug":"黑客秘笈：渗透测试实用指南","count":1,"path":"api/tags/黑客秘笈：渗透测试实用指南.json"}]}