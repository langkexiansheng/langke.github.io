{"title":"文件操作小脚本","slug":"文件操作小脚本","date":"2018-09-19T07:54:47.000Z","updated":"2018-09-25T12:25:32.606Z","comments":true,"path":"api/articles/文件操作小脚本.json","photos":[],"link":"","excerpt":"前情提要由于要处理大批量的文件，没有找到对应的工具。主要是 python 好用。<br>话不多说，直接上代码：<br>","covers":["https://bj.bcebos.com/v1/image-langke/img/listdir_s.png"],"content":"<h2 id=\"前情提要\"><a href=\"#前情提要\" class=\"headerlink\" title=\"前情提要\"></a>前情提要</h2><blockquote>\n<p>由于要处理大批量的文件，没有找到对应的工具。主要是 <em>python</em> 好用。<br>话不多说，直接上代码：<br><a id=\"more\"></a></p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python3 </span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> docx</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定义几个全局变量</span></span><br><span class=\"line\">path1 = <span class=\"string\">'C:\\\\Users\\\\langke\\\\Documents\\\\漏洞描述模版-图\\\\'</span></span><br><span class=\"line\">path2 = <span class=\"string\">'C:\\\\Users\\\\langke\\\\Desktop\\\\'</span></span><br><span class=\"line\">PATH3 = os.path.abspath(<span class=\"string\">'.'</span>)+<span class=\"string\">\"\\\\\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取符合条件的文件名</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_FileName</span><span class=\"params\">(search,position=<span class=\"number\">0</span>)</span>:</span></span><br><span class=\"line\">\t<span class=\"comment\"># 获取指定目录下的所有指定后缀的文件名</span></span><br><span class=\"line\">\tf_list = os.listdir(PATH3)</span><br><span class=\"line\">\t<span class=\"comment\"># print(f_list)  获取指定目录下所有文件名和文件夹名</span></span><br><span class=\"line\">\tfile_fuhe = []</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> f_list:</span><br><span class=\"line\">\t\t<span class=\"comment\"># os.path.splitext(i)   分割文件名和后缀</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> os.path.splitext(i)[<span class=\"number\">1</span>] == <span class=\"string\">'.docx'</span>:</span><br><span class=\"line\">\t\t\t<span class=\"comment\"># print(i)  输出文件名</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span>:\t</span><br><span class=\"line\">\t\t\t\tdata = docx.Document(PATH3+i) </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">\t\t\t\tprint(e)\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> index,para <span class=\"keyword\">in</span> enumerate(data.paragraphs):</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\"># 判断想处理的内容</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> search <span class=\"keyword\">in</span> para.text:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> position:\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\tprint(<span class=\"string\">\"=\"</span>*<span class=\"number\">30</span>)</span><br><span class=\"line\">\t\t\t\t\t\tprint(<span class=\"string\">\"在第%d行\"</span> % index,<span class=\"string\">\"文件名是：\"</span>+i)</span><br><span class=\"line\">\t\t\t\t\t\tprint(<span class=\"string\">\"=\"</span>*<span class=\"number\">30</span>)</span><br><span class=\"line\">\t\t\t\t\tfile_fuhe.append(i)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"keyword\">not</span> file_fuhe:</span><br><span class=\"line\">\t\texit(<span class=\"string\">\"\\n***没有匹配到！***\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> file_fuhe\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#用来删除文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">del_FileName</span><span class=\"params\">(delnames)</span>:</span></span><br><span class=\"line\">\tprint(<span class=\"string\">\"\\n\\t###\\n\\t将要删除以下文件：\\n\\t###\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> delname <span class=\"keyword\">in</span> delnames:</span><br><span class=\"line\">\t\tprint(delname)</span><br><span class=\"line\">\t\tqq = str(input(<span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">\t\t++++++++++++++++++++++++++++++++</span></span><br><span class=\"line\"><span class=\"string\">\t\t确定要删除吗？确定请按 y 并回车。</span></span><br><span class=\"line\"><span class=\"string\">\t\t++++++++++++++++++++++++++++++++</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t\"\"\"</span>))</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> qq == <span class=\"string\">\"y\"</span>:</span><br><span class=\"line\">\t\t\tos.remove(delname)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\tparser = argparse.ArgumentParser(description=<span class=\"string\">'可以对文件进行你想要的操作'</span>)</span><br><span class=\"line\">\tparser.add_argument(<span class=\"string\">'-s'</span>,dest=<span class=\"string\">'search'</span>,help=<span class=\"string\">'输入想要搜索的内容,比如：-s \"你好\"'</span>)</span><br><span class=\"line\">\tparser.add_argument(<span class=\"string\">'-d'</span>,dest=<span class=\"string\">'dirs'</span>,help=<span class=\"string\">'''输入想要操作的目录，默认当前目录。</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t\t\t\t\t格式如：-d \"C:\\\\\\\\Users\\\\\\\\langke\\\\\\\\Desktop\\\\\\\\\"'''</span>)</span><br><span class=\"line\">\tparser.add_argument(<span class=\"string\">'-p'</span>,dest=<span class=\"string\">'position'</span>,help=<span class=\"string\">'如果想查看匹配到的内容在文件中的位置，请指定该参数。如： -p 1'</span>)</span><br><span class=\"line\">\targs = parser.parse_args()</span><br><span class=\"line\">\tsearch = args.search</span><br><span class=\"line\">\tdirs = args.dirs</span><br><span class=\"line\">\tposition = args.position</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"keyword\">not</span> search:</span><br><span class=\"line\">\t\texit(<span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t========================================</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t没有指定要搜索的内容,按 -h 获取更多帮助</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t========================================</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t'''</span>)</span><br><span class=\"line\">\tdel_FileName(get_FileName(search=search,position=position))</span><br><span class=\"line\"></span><br><span class=\"line\">main()</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p><img src=\"https://bj.bcebos.com/v1/image-langke/img/listdir_s.png\" alt=\"示例\"></p>\n<p>不足的地方，自行更改。。</p>\n","categories":[],"tags":[{"name":"python工具","slug":"python工具","count":1,"path":"api/tags/python工具.json"}]}