<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>THE-HACKER-PLAYBOOK-3-笔记-红队侦查 | langke Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">langke&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">langke&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div id="post-toc" class="post-toc">
            <span class="post-toc-title">catalogue</span>
            <div class="post-toc-content">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#扫描结果差异化分析"><span class="toc-text">扫描结果差异化分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-应用程序监控"><span class="toc-text">Web 应用程序监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络和服务的搜索引擎"><span class="toc-text">网络和服务的搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Shodan"><span class="toc-text">Shodan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Censys-io"><span class="toc-text">Censys.io</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手动解析SSL证书"><span class="toc-text">手动解析SSL证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#子域名发现"><span class="toc-text">子域名发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Discover-Scripts"><span class="toc-text">Discover Scripts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KNOCK"><span class="toc-text">KNOCK</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#先决条件"><span class="toc-text">先决条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#依赖"><span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#安装-1"><span class="toc-text">安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sublist3r"><span class="toc-text">Sublist3r</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-2"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#依赖关系"><span class="toc-text">依赖关系</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子"><span class="toc-text">例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#脚本引用"><span class="toc-text">脚本引用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Github"><span class="toc-text">Github</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitMiner"><span class="toc-text">GitMiner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Truffle-Hog"><span class="toc-text">Truffle Hog</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cloud"><span class="toc-text">Cloud</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#S3-Bucket-Enumeration-S3存储桶-枚举"><span class="toc-text">S3 Bucket Enumeration (S3存储桶 枚举)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#电子邮件"><span class="toc-text">电子邮件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SimplyEmail"><span class="toc-text">SimplyEmail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#之前的email信息泄露"><span class="toc-text">之前的email信息泄露</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#额外的开源资源"><span class="toc-text">额外的开源资源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#本章总结"><span class="toc-text">本章总结</span></a>
            </li></div>
        </div>
    
    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">THE-HACKER-PLAYBOOK-3-笔记-红队侦查</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">langke</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">April 1, 2019&nbsp;&nbsp;15:07:35</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <section class="post-content">
            <p>我们可以通过使用不同的工具来进行环境扫描、服务探测、检索云计算配置错误。<br>这些活动有助于你收集有关目标基础设施的更多信息，并找到攻击的最好方法。</p>
<h2 id="扫描结果差异化分析"><a href="#扫描结果差异化分析" class="headerlink" title="扫描结果差异化分析"></a>扫描结果差异化分析</h2><p>比如端口：</p>
<ul>
<li>每天进行扫描</li>
<li>把每天的今天和前一天的扫描结果做了对比</li>
<li>把改变的内容通知红队的团队</li>
<li>工具方面，精细化扫描nmap；大范围扫描Masscan，作者声称宽带足够大，6分钟扫整个互联网。<br>例如：</li>
</ul>
<a id="more"></a>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">TARGETS=<span class="string">"192.168.1.0/24"</span></span><br><span class="line">OPTIONS=<span class="string">"-v -T4 -F -sV"</span></span><br><span class="line">date=$(date +%Y-%m-%d-%H-%M-%S)</span><br><span class="line"><span class="built_in">cd</span> /nmap/diffs</span><br><span class="line">nmap <span class="variable">$OPTIONS</span> <span class="variable">$TARGETS</span> -oA scan-<span class="variable">$date</span> &gt; /dev/null</span><br><span class="line"><span class="function"><span class="title">slack</span></span>()&#123;</span><br><span class="line">curl -F file=@diff-<span class="variable">$date</span> -F initial_comment=<span class="string">"Internal Port Change Detected"</span> -F channels=<span class="comment">#alerts -F token=xxxx-xxxx-xxxx https://slack.com/api/files.upload</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e scan-prev.xml ]; <span class="keyword">then</span></span><br><span class="line">ndiff scan-prev.xml scan-<span class="variable">$date</span>.xml &gt; diff-<span class="variable">$date</span></span><br><span class="line">[ <span class="string">"$?"</span> -eq <span class="string">"1"</span> ] &amp;&amp; sed -i -e 1,3d diff-<span class="variable">$date</span> &amp;&amp; slack</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">ln -sf scan-<span class="variable">$date</span>.xml scan-prev.xml</span><br></pre></td></tr></table></figure>
<h2 id="Web-应用程序监控"><a href="#Web-应用程序监控" class="headerlink" title="Web 应用程序监控"></a>Web 应用程序监控</h2><p>可以使用下面两个工具来帮助监视应用程序的变化</p>
<ul>
<li><a href="https://github.com/breenmachine/httpscreenshot" target="_blank" rel="noopener">HTTPScreenshot</a></li>
<li><a href="https://github.com/FortyNorthSecurity/EyeWitness" target="_blank" rel="noopener">Eyewitness</a><br><del>后续再添加详细使用过程</del></li>
</ul>
<h2 id="网络和服务的搜索引擎"><a href="#网络和服务的搜索引擎" class="headerlink" title="网络和服务的搜索引擎"></a>网络和服务的搜索引擎</h2><p>可以使用谷歌和第三方扫描服务<br>可以查找关于服务器、开放服务、banner和其他细节的信息<br>而目标公司永远不会知道你通过查询获取了这类信息</p>
<h3 id="Shodan"><a href="#Shodan" class="headerlink" title="Shodan"></a><a href="https://www.shodan.io/" target="_blank" rel="noopener">Shodan</a></h3><p>Shodan是一个伟大的网络服务，它定期扫描互联网，抓取banners、端口、网络信息等等<br>一些基本的搜索查询：</p>
<ul>
<li>title：搜索从HTML标记的title属性中提取的内容</li>
<li>html：搜索返回页面的完整HTML内容</li>
<li>product：搜索banner中标识的软件或产品的名称</li>
<li>net：搜索一个指定的网段（例如：204.51.94.79/18）</li>
</ul>
<h3 id="Censys-io"><a href="#Censys-io" class="headerlink" title="Censys.io"></a><a href="https://censys.io/" target="_blank" rel="noopener">Censys.io</a></h3><p>持续监控Internet上的每一台可访问的服务器和设备，以便实时搜索和分析。</p>
<p>这两个工具，免费版都没多大用处，<br>shodan搜索特定系统主机的时候，给列出一些9几年抓取的数据。。。<br>censys.io提供的信息太少，端口、服务、证书链<br>会员太贵，一月上千刀。</p>
<h2 id="手动解析SSL证书"><a href="#手动解析SSL证书" class="headerlink" title="手动解析SSL证书"></a>手动解析SSL证书</h2><p>随着云服务使用量的增加，许多公司没有正确地配置安全的访问控制列表。<br>Redis数据库、Jenkin服务器、Tomcat管理、NoSQL数据库等等暴露再互联网上。<br>其中许多可以导致远程代码执行以至利益损失。<br>找到这些服务器的轻松而又不为人知的方法是再网络上以自动化的方式手动扫描SSL证书。<br>我们可以获取云服务提供商的IP范围列表，并定期扫描所有这些列表以提取SSL证书。<br>我强烈建议你从这段代码（也就是 sslScrape 的源码）开始，试着将所有获得的主机名保存到一个数<br>据库里，再做一个 Web UI 前端作为展示页面。然后去连接其他可能有证书的端口，比如 8443 端口，这样可以从证<br>书中获取主机的信息。甚至可以加上扫描 .git 或者 .svn 等源码信息泄露的功能。<br><a href="https://www.secpulse.com/archives/55286.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/55286.html</a></p>
<h2 id="子域名发现"><a href="#子域名发现" class="headerlink" title="子域名发现"></a>子域名发现</h2><p>可以从区域互联网注册管理机构这样的公共资源来查找某个公司。<br>可以查找IP地址的拥有着、某个公司的网络、组织的自治系统编号等等。<br>比如美洲互联网号码注册管理机构（ARIN）管理北美和部分加勒比地区事务<br>要看北美以外的地区，可以通过AFRINIC(非洲)、APNIC(亚洲)、LACNIC(拉丁美洲)、RIPE NCC(欧洲)查找。<br>子域名对于要攻击的目标也很重要，原因如下：</p>
<ul>
<li>一些子域可以表明它是什么类型的服务器（即dev、vpn、mail、internal、test）。例如：mail.cyberspacekittens.com</li>
<li>一些网站服务器无法通过IP去访问，也就是多个服务器共享一个出口IP的情况。这些服务器可能位于共享的基础设施上（比如virtual host），如果你要访问这些网站，就只能通过域名去访问。</li>
<li>收集子域名可以获得目标在哪托管他们服务器的信息。这是通过找出目标全部子域名、针对子域名反向查询IP以及查询托管UO的地方来完成。一家公司可能会使用多个云服务提供商和数据中心来托管他们的服务器。</li>
</ul>
<h3 id="Discover-Scripts"><a href="#Discover-Scripts" class="headerlink" title="Discover Scripts"></a><a href="https://github.com/leebaird/discover" target="_blank" rel="noopener">Discover Scripts</a></h3><p>用于Kali Linux。用于自动执行各种测试任务的自定义bash脚本。<br>它结合了Kali Linux上的所有的子域名侦查工具，并定期进行维护更新。<br>被动信息收集将利用下列所有的工具：<code>Passive uses ARIN</code>,<code>dnsrecon</code>,<code>goofile</code>,<code>goog-mail</code>,<code>goohost</code>,<code>theHarvester</code>,<code>Metasploit</code>,<code>URLCrazy</code>,<code>whois</code>,<code>multiple</code>,<code>websites</code>,<code>recon-ng</code>.</p>
<p><code>Discover Scripts</code>最棒的地方在于，它基于已收集到的信息滚雪球式搜索。<br>例如：通过对公开的PGP仓库进行搜索，它可能会识别电子邮件，然后使用这些信息继续在<a href="https://haveibeenpwned.com/" target="_blank" rel="noopener"><code>Have I Been Pwned</code></a>网站进行搜索（通过 <a href="https://bitbucket.org/LaNMaSteR53/recon-ng" target="_blank" rel="noopener">Recon-NG工具</a>）。这将让我们知道是否可以通过公开发布的数据泄露危害找到一些泄露出的密码。</p>
<p>如果要利用，请使用Metasploit Framework。如果您想要社交工程师，请使用Social-Engineer Toolkit。如果你想进行侦察，请使用Recon-ng！</p>
<p><a href="https://github.com/leebaird/discover" target="_blank" rel="noopener">使用说明</a></p>
<p><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/discover_option.jpg" alt><br>测试了一下 7 IP扫描的功能.本来测试 1 domain模块的，太慢了，就换另一个了。</p>
<p>用的时候，直接选择响应模块的数字就好了。最后输入参数。开始扫描。<br>对应模块翻译：</p>
<ol>
<li>Domain =&gt; 域</li>
<li>Person =&gt; 人 （这个模块不适合国内）<br>后面的都不怎么好用，知道第一个就行了。</li>
</ol>
<p><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/ip_scan.jpg" alt></p>
<h3 id="KNOCK"><a href="#KNOCK" class="headerlink" title="KNOCK"></a><a href="https://github.com/guelfoweb/knock" target="_blank" rel="noopener">KNOCK</a></h3><p>重点是爆破<br>Knockpy是一个python工具，旨在通过wordlist枚举目标域上的子域。它旨在扫描DNS区域传输，并尝试在启用时自动绕过通配符DNS记录。现在knockpy支持对VirusTotal子域的查询，您可以在config.json文件中设置API_KEY。</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><h5 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h5><ul>
<li>Python 2.7.6</li>
</ul>
<h5 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h5><ul>
<li>Dnspython<br><code>sudo apt-get install python-dnspython</code></li>
</ul>
<h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/guelfoweb/knock.git /opt/knock</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /opt/knock</span><br><span class="line"></span><br><span class="line">$ vim knockpy/config.json &lt; - 设置你的virustotal API_KEY</span><br><span class="line"></span><br><span class="line">$ sudo python setup.py install</span><br><span class="line"></span><br><span class="line">// virustotal API_KEY获取办法</span><br><span class="line">// 去https://www.virustotal.com免费注册账号</span><br><span class="line">// 成功注册后登陆，来到个人中心即可看到。（免费版有限制）</span><br><span class="line">// 建议使用Google DNS：8.8.8.8和8.8.4.4</span><br></pre></td></tr></table></figure>
<p>作者比较喜欢的一个<a href="https://gist.githubusercontent.com/cheetz/4d6a26bb122a942592ab9ac21894e57b/raw/f58e82c9abfa46a932eb92edbe6b18214141439b/all.txt" target="_blank" rel="noopener">字典</a><br><a href="https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS" target="_blank" rel="noopener">github库子域名收藏库</a></p>
<p>下面几张图是安装的补充：<br><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/VIRUSTOTAL_KEY.jpg" alt><br><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/VIM_config.jpg" alt><br><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/knock_help.jpg" alt><br><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/knock_scan_baidu.jpg" alt></p>
<h3 id="Sublist3r"><a href="#Sublist3r" class="headerlink" title="Sublist3r"></a><a href="https://github.com/aboul3la/Sublist3r" target="_blank" rel="noopener">Sublist3r</a></h3><p>重点是利用搜索引擎搜索。<br>Sublist3r是一个python工具，旨在使用OSINT枚举网站的子域。<br>Sublist3r使用许多搜索引擎枚举子域，例如Google，Yahoo，Bing，Baidu和Ask。Sublist3r还使用Netcraft，Virustotal，ThreatCrowd，DNSdumpster和ReverseDNS枚举子域。</p>
<h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><h5 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sublist3r依赖于requests，dnspython和argparsePython模块。</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/aboul3la/Sublist3r.git /opt/Sublist3r</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /opt/Sublist3r</span><br></pre></td></tr></table></figure>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><table>
<thead>
<tr>
<th style="text-align:left">简写</th>
<th style="text-align:left">长写</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-d</td>
<td style="text-align:left">–domain</td>
<td style="text-align:left">用于枚举子域的域名</td>
</tr>
<tr>
<td style="text-align:left">-b</td>
<td style="text-align:left">–bruteforce</td>
<td style="text-align:left">启用subbrute bruteforce模块</td>
</tr>
<tr>
<td style="text-align:left">-p</td>
<td style="text-align:left">–ports</td>
<td style="text-align:left">根据特定的TCP端口扫描找到的子域</td>
</tr>
<tr>
<td style="text-align:left">-v</td>
<td style="text-align:left">–verbose</td>
<td style="text-align:left">启用详细模式并实时显示结果</td>
</tr>
<tr>
<td style="text-align:left">-t</td>
<td style="text-align:left">–threads</td>
<td style="text-align:left">subbrute bruteforce使用的线程数</td>
</tr>
<tr>
<td style="text-align:left">-e</td>
<td style="text-align:left">–engines</td>
<td style="text-align:left">指定以逗号分隔的搜索引擎列表</td>
</tr>
<tr>
<td style="text-align:left">-o</td>
<td style="text-align:left">–output</td>
<td style="text-align:left">将结果保存到文本文件</td>
</tr>
<tr>
<td style="text-align:left">-H</td>
<td style="text-align:left">–help</td>
<td style="text-align:left">显示帮助消息并退出</td>
</tr>
</tbody>
</table>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><ul>
<li>枚举子域并使用特定引擎，如Google，Yahoo和Virustotal引擎</li>
</ul>
<p><code>python sublist3r.py -d example.com</code></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">                 ____        _     _ _     _   _____</span><br><span class="line">                / ___| _   _| |__ | (_)___| |_|___ / _ __</span><br><span class="line">                \___ \| | | | '_ \| | / __| __| |_ \| '__|</span><br><span class="line">                 ___) | |_| | |_) | | \__ \ |_ ___) | |</span><br><span class="line">                |____/ \__,_|_.__/|_|_|___/\__|____/|_|</span><br><span class="line"></span><br><span class="line">                # Coded By Ahmed Aboul-Ela - @aboul3la</span><br><span class="line">    </span><br><span class="line">[-] Enumerating subdomains now <span class="keyword">for</span> baidu.com</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Baidu..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Yahoo..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Google..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Bing..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Ask..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Netcraft..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> DNSdumpster..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Virustotal..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> ThreatCrowd..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> SSL Certificates..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> PassiveDNS..</span><br><span class="line">[-] Total Unique Subdomains Found: <span class="number">2329</span></span><br><span class="line">www.baidu.com</span><br><span class="line"><span class="number">1</span>.baidu.com</span><br><span class="line"><span class="number">8</span>.baidu.com</span><br><span class="line">······（略）</span><br><span class="line">zhuanjia.baidu.com</span><br><span class="line">zidao.baidu.com</span><br><span class="line">zn.baidu.com</span><br><span class="line">znsv.baidu.com</span><br><span class="line">zuoye.baidu.com</span><br><span class="line">zz.baidu.com</span><br><span class="line">api.zz.baidu.com</span><br><span class="line"></span><br><span class="line">// 共<span class="number">2325</span>个</span><br></pre></td></tr></table></figure>
<h4 id="脚本引用"><a href="#脚本引用" class="headerlink" title="脚本引用"></a>脚本引用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sublist3r</span><br><span class="line">subdomains = sublist3r.main(<span class="string">'baidu.com'</span>, <span class="number">40</span>, <span class="string">'baidu_subdomain.txt'</span>, ports= <span class="keyword">None</span>, silent=<span class="keyword">False</span>, verbose= <span class="keyword">False</span>, enable_bruteforce= <span class="keyword">False</span>, engines=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h2><p>许多开发人员要么将代码保存到错误的仓库（将其发送到他们的公开仓库而不是公司的私有仓库），要么意外地保存敏感数据（如密码），然后试图删除它。<br>Github的一个优点是，它可以在每次修改或删除代码时进行记录。这意味着如果有一次将敏感数据保存到仓库中，那么即使删除了该敏感数据，它仍然会在数据更改中被记录。</p>
<h3 id="GitMiner"><a href="#GitMiner" class="headerlink" title="GitMiner"></a>GitMiner</h3><p>推荐一个大佬开源的github搜索语法工具<a href="https://github.com/UnkL4b/GitMiner" target="_blank" rel="noopener">==》</a></p>
<p>安装方法见GitHub工具主页。<br>示例：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 gitminer-v2.0.py -q <span class="string">'filename:shadow path:etc'</span> -m root -c /root/cookie.txt -o orss.txt</span><br></pre></td></tr></table></figure></p>
<p>搜索文件名<code>shadow</code>，路径<code>etc</code>，-q：GitHub搜索语句，-c:cookie文件名，-o：输出文件。<br><img src="https://bj.bcebos.com/v1/image-langke/hexo-neirongpeitu/黑客秘籍3/shadow_root.jpg" alt></p>
<p>详细使用：<br>寻找包含密码的brasilian政府文件：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$:&gt; python3 gitminer-v2.0.py --query <span class="string">'extension:php "root" in:file AND "gov.br" in:file'</span> -m senhas -c cookie.txt</span><br></pre></td></tr></table></figure></p>
<p>brasilian:巴西、senhas：葡萄牙语，翻译为汉语是‘密码’</p>
<p>在etc路径搜索shadow文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$:&gt; python3 gitminer-v2.0.py --query <span class="string">'filename:shadow path:etc'</span> -m root -c cookie.txt</span><br></pre></td></tr></table></figure></p>
<p>使用密码搜索joomla配置文件：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$:&gt; python3 gitminer-v2.0.py --query <span class="string">'filename:configuration extension:php "public password" in:file'</span> -m joomla -c cookie.txt</span><br></pre></td></tr></table></figure></p>
<p>更多命令自己构建。</p>
<h3 id="Truffle-Hog"><a href="#Truffle-Hog" class="headerlink" title="Truffle Hog"></a><a href="https://github.com/dxa4481/truffleHog" target="_blank" rel="noopener">Truffle Hog</a></h3><p>Truffle Hog工具会扫描不同的提交历史记录和分支来获取高机密的密钥，并输出它们。</p>
<p><strong>安装</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install truffeHog</span><br></pre></td></tr></table></figure></p>
<p>使用时，可后面直接跟存储库地址。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@vm1:~<span class="comment"># trufflehog https://github.com/cyberspacekittens/dnscat2</span></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Reason: High Entropy</span><br><span class="line">Date: 2018-01-13 21:58:04</span><br><span class="line">Hash: 403a412ba15c765680547cb69c16570915957e2c</span><br><span class="line">Filepath: server/controller/csk.config</span><br><span class="line">Branch: origin/master</span><br><span class="line">Commit: Config Update</span><br><span class="line">@@ -1,33 +0,0 @@</span><br><span class="line">-dnscat.config</span><br><span class="line">-<span class="string">"awsSecretKey"</span>:<span class="string">"28dunBEhc374473Hdkql3kvdk881AYvne349KD3"</span></span><br><span class="line">-<span class="string">"awsAccessId"</span>:<span class="string">"AKIAJFHD345JFENC34FD"</span></span><br><span class="line">-<span class="string">"client_secret"</span>:<span class="string">"JFHe43fkwDjen3r8fjd3Dje8"</span></span><br><span class="line">-<span class="string">"secretkey"</span>:<span class="string">"cyberspacekittenssupersecurepassword"</span></span><br><span class="line">-</span><br><span class="line">------BEGIN RSA PRIVATE KEY-----</span><br><span class="line">-MIIEpAIBAAKCAQEAwU/01pfXiORTEzhu46rXRNAPwfY3zWMiZDnwu1sZBmedVR0n</span><br><span class="line">-fX+4nPAh2dzy+/qp+DJmGs/iLfdtHC6U/9Arvh9NioHEfoqColZPGOoqyqkcut/e</span><br><span class="line">-fAHxjLvRjwsoCRfcND4gtTZ29/r8mixbCa3LayDD4HZHz7ClZMi6DajF6h0Bf1i3</span><br><span class="line">-XO2PBj0aybP/2GYCLc7Zpgb3+jXU6J4beuk3bAOnfZNQwPjec844I98EUN2auDaX</span><br><span class="line">-0tYmunEKmt2JAuaAlVSOMC2VmM0Cu13cWRh1jMu4+mf0xgx28Lo2tpWIFabJ61T2</span><br><span class="line">-HNNvmUWTy51DoWnvF9IrnOxmv48GwVLDtvHBgQIDAQABAoIBAAENk3LbzuPDAqTX</span><br><span class="line">-KNt6ocORMpTG55Tp1lUfb61FmMRNKjE9gGqRmIraUATkzDoNKoHcnGvG+B9x+pkt</span><br><span class="line">-s8gU9TgK6Zw4ir55uK5zs+iZ1fPWqf5mm8qnJA61MzYJRIWQKLXsJLd3/XvqVRft</span><br><span class="line">-5+0MklAaFJcTbd62wp/i7AiJA9L7pQpJq/yCS8LjTtVrajXB9Pido/rhVLJwe3ov</span><br><span class="line">-1c59NaxUOI1641RIwRVSBhrmfme+S86IaRml8IXmpkjsyvSdxDvPOBA2LUwemrIG</span><br><span class="line">-WhusZbsVd5pMP7kKyyjagTspPJm5gwpAyHiDptFiEJck12VNLo36vKB1E9RdTZ/1</span><br><span class="line">-NK0YRKUCgYEA6U/XdFEyj3HWBn9W+e58yY5afmpH6wbwOz0plvwax25R4giJ/FsB</span><br><span class="line">-fJWEBNzSR/BdFFR6/C/+AwvXQ2AmYjrmGusIp8yS/2HK95vWIK00iYqSgxc6XRRk</span><br><span class="line">-f7fPSSkLl77D7DSJ7pvh3V/pJiBXDjLJzJoWmyN9FAj+H5uE5FEPTvsCgYEA1BxZ</span><br><span class="line">-oCMxH7d9gjM9BRKqT+BFUYmvk+1oFIdgcZ5YuAfPQbpHIsu7mb9g14t17a+Ygu1B</span><br><span class="line">-92GPlz9UFmn8y2r6xJ/uxRgjL3V3D7EQmfM8jQIU3SMa7vhHA6p1Q9fHx34+0mjB</span><br><span class="line">-570XVq5Ujzjyo8LT3kCSQXSgmKu26ovAgq2iGLMCgYBIpww4tHBCKviy3USAX7uM</span><br><span class="line">-KEAVzZLHpUl5qPoigi70m230LSSK6Ov1l7mcqgbxT/AsPIJvtaIr4KwP1wkc3ap6</span><br><span class="line">-B2aSminMTO+fW2+6jTUm/3fQSpNqGMeS3fI2ngl2H3lzPIkXPIOBJDS+IqP5T+d3</span><br><span class="line">-RyRy+wIgEwzPWuZvEq7psQKBgQDGMZtZc6iyHy0KXMA2nkM/kaqTztidm6a2D+0B</span><br><span class="line">-HVl+0+VIYDuZ+s5Xkih2H1zY9EvIgtMxyRp30/fJXc2VcWfSFDLyPWSbMuJGake9</span><br><span class="line">-4jcA9yHxo5zGEH2iokMiWlzVPlSLHNGarOhC2XAvx6GJfUGlGabPvJ9XKJQpQt5l</span><br><span class="line">-/MJK2wKBgQCFln5YGqRONBX2OJV2Eyga/EdbgFFcJwHsQ5+rcBzyBgQWTVKk1aHI</span><br><span class="line">-X5OvPX40HvmnPhsLhb6cHSwI3iHXNNykQtua1ae05se4wxJNoCBuAa54eGDd/mjf</span><br><span class="line">-ERtB8pFer2nL7JraiXb/ILT83rYiTq2iN+DyCOdOyesiKOvMpKCt2Q==</span><br><span class="line">------END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">······（略）</span><br><span class="line"></span><br><span class="line">@@ -2,18 +2,18 @@ Greetings, and I hope you<span class="string">'re all having a great holiday!</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Cloud"><a href="#Cloud" class="headerlink" title="Cloud"></a>Cloud</h2><p>cloud是我们看到的许多公司有不安全环境配置的一个领域。最常见的一些问题是：</p>
<ul>
<li>Amazon S3 Missing Buckets: <a href="https://hackerone.com/reports/121461" target="_blank" rel="noopener">https://hackerone.com/reports/121461</a></li>
<li>Amazon S3 Bucket Permissions: <a href="https://hackerone.com/reports/128088" target="_blank" rel="noopener">https://hackerone.com/reports/128088</a></li>
<li>能够列出文件并将文件写入公共AWS桶:<ul>
<li>aws s3 ls s3://[bucketname]</li>
<li>aws s3 mv test.txt s3://[bucketname]</li>
</ul>
</li>
<li>Lack of Logging-缺乏记录</li>
</ul>
<h3 id="S3-Bucket-Enumeration-S3存储桶-枚举"><a href="#S3-Bucket-Enumeration-S3存储桶-枚举" class="headerlink" title="S3 Bucket Enumeration (S3存储桶 枚举)"></a>S3 Bucket Enumeration (S3存储桶 枚举)</h3><p>工具的Github库已被工具的作者删掉，并被另一个人（无耻的）注册。<br>幸好本书作者提供了一个安装了本书所有工具的VMware。<br>只能搜索 枚举亚马逊云相关的。<br>这节就先不看了。</p>
<h2 id="电子邮件"><a href="#电子邮件" class="headerlink" title="电子邮件"></a>电子邮件</h2><p>所有的社会工程学攻击的一个重要部分都是查找 email 地址和员工姓名。我们在前几节中使用了 Discover Script 工<br>具，它非常适合用来收集这些数据。我个人通常从 Discover Script 开始，并用其他工具进行深入挖掘。每种工具的<br>功能略有不同，尽可能多地使用自动化流程是有益的。<br>一旦你得到了一个小的 email 列表，最好去了解他们的 email 格式。是<code>名+姓氏@cyberspacekitten.com</code>这样的格式吗？还是<code>名的第一个字母+姓氏@cyberspacekittens.com</code>这样的？然后去，额，ink不适合中国。</p>
<h3 id="SimplyEmail"><a href="#SimplyEmail" class="headerlink" title="SimplyEmail"></a><a href="https://github.com/SimplySecurity/SimplyEmail" target="_blank" rel="noopener">SimplyEmail</a></h3><p>我们都知道<a href="https://searchsecurity.techtarget.com.cn/whatis/11-25390/" target="_blank" rel="noopener">鱼叉式网络钓鱼</a>仍然是比较成功的攻击手段之一。如果我们没有找到任何外部漏洞，那么下一步就是攻击<br>用户。要建立一个好的 email 地址列表，我们可以使用像 SimplyEmail 这样的工具。此工具的作用是可以输出公司<br>的 email 地址格式和有效用户列表。</p>
<p><strong>安装</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s https://raw.githubusercontent.com/killswitch-GUI/SimplyEmail/master/setup/oneline-setup.sh | bash</span></span><br><span class="line">root@kali:~<span class="comment"># cd SimplyEmail</span></span><br><span class="line">(SE) root@kali:~/SimplyEmail<span class="comment"># ./SimplyEmail.py</span></span><br></pre></td></tr></table></figure>
<p>or<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># docker pull simplysecurity/simplyemail</span></span><br><span class="line">root@kali:~<span class="comment"># docker run -ti simplysecurity/simplyemail</span></span><br></pre></td></tr></table></figure></p>
<h3 id="之前的email信息泄露"><a href="#之前的email信息泄露" class="headerlink" title="之前的email信息泄露"></a>之前的email信息泄露</h3><ul>
<li>1.4 亿密码泄露（2017年）： <a href="https://thehackernews.com/2017/12/data-breach-password-list.html" target="_blank" rel="noopener">https://thehackernews.com/2017/12/data-breach-password-list.html</a></li>
<li>Adobe 信息泄露（2013年）： <a href="https://nakedsecurity.sophos.com/2013/11/04/anatomy-of-a-password-disaster-adobes-giant-sized-cryptographic-blunder/" target="_blank" rel="noopener">https://nakedsecurity.sophos.com/2013/11/04/anatomy-of-a-password-disaster-adobes-giant-sized-cryptographic-blunder/</a></li>
<li>Pastebin Dumps： <a href="http://psbdmp.ws/" target="_blank" rel="noopener">http://psbdmp.ws/</a></li>
<li>Exploit.In Dump</li>
<li>Pastebin 的 Google Dork: site:pastebin.com intext:cyberspacekittens.com</li>
</ul>
<h1 id="额外的开源资源"><a href="#额外的开源资源" class="headerlink" title="额外的开源资源"></a>额外的开源资源</h1><p>公开资源情报计划（Open source intelligence），简称OSINT,是美国中央情报局（CIA）的一种情报搜集手段，从各种公开的信息资源中寻找和获取有价值的情报。</p>
<ul>
<li>OSINT 链接合集: <a href="https://github.com/IVMachiavelli/OSINT_Team_Links" target="_blank" rel="noopener">https://github.com/IVMachiavelli/OSINT_Team_Links</a></li>
<li>OSINT 框架: <a href="http://osintframework.com/" target="_blank" rel="noopener">http://osintframework.com/</a></li>
</ul>
<h1 id="本章总结"><a href="#本章总结" class="headerlink" title="本章总结"></a>本章总结</h1><p>在这一章中，我们学习了各种不同的侦察战术和侦察工具。这只是一个开始，因为这些技术许多都是手工的，并且需<br>要大量的时间来执行。这取决于你自己是否能提高自己的功力，自动化使用所有这些工具，并使侦察工作快速和高<br>效。</p>

        </section>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>langke</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://yoursite.com/2019/04/01/THE-HACKER-PLAYBOOK-3-笔记-红队侦察/">http://yoursite.com/2019/04/01/THE-HACKER-PLAYBOOK-3-笔记-红队侦察/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="https://langkexiansheng">Langke</a></span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</strong></strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/THE-HACKER-PLAYBOOK-3/"># THE-HACKER-PLAYBOOK-3</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/04/11/THE-HACKER-PLAYBOOK-3-笔记-Web应用程序漏洞利用/">THE-HACKER-PLAYBOOK-3-笔记-Web应用程序漏洞利用</a>
            
            
            <a class="next" rel="next" href="/2019/03/28/THE-HACKER-PLAYBOOK-3-笔记-安装/">THE HACKER PLAYBOOK 3 -- 笔记 -- 安装</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© langke | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
